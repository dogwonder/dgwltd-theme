(()=>{var Ct=Object.create;var vt=Object.defineProperty;var At=Object.getOwnPropertyDescriptor;var Nt=Object.getOwnPropertyNames;var Yt=Object.getPrototypeOf,Rt=Object.prototype.hasOwnProperty;var V=(n,t)=>()=>(t||n((t={exports:{}}).exports,t),t.exports);var Et=(n,t,e,a)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of Nt(t))!Rt.call(n,r)&&r!==e&&vt(n,r,{get:()=>t[r],enumerable:!(a=At(t,r))||a.enumerable});return n};var J=(n,t,e)=>(e=n!=null?Ct(Yt(n)):{},Et(t||!n||!n.__esModule?vt(e,"default",{value:n,enumerable:!0}):e,n));var yt=V((at,nt)=>{(function(n,t){typeof at=="object"&&typeof nt<"u"?nt.exports=t():typeof define=="function"&&define.amd?define(t):(n=typeof globalThis<"u"?globalThis:n||self).dayjs=t()})(at,(function(){"use strict";var n=1e3,t=6e4,e=36e5,a="millisecond",r="second",f="minute",u="hour",y="day",C="week",x="month",$="quarter",w="year",g="date",d="Invalid Date",p=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,O=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,k={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(c){var o=["th","st","nd","rd"],i=c%100;return"["+c+(o[(i-20)%10]||o[i]||o[0])+"]"}},S=function(c,o,i){var l=String(c);return!l||l.length>=o?c:""+Array(o+1-l.length).join(i)+c},Y={s:S,z:function(c){var o=-c.utcOffset(),i=Math.abs(o),l=Math.floor(i/60),s=i%60;return(o<=0?"+":"-")+S(l,2,"0")+":"+S(s,2,"0")},m:function c(o,i){if(o.date()<i.date())return-c(i,o);var l=12*(i.year()-o.year())+(i.month()-o.month()),s=o.clone().add(l,x),h=i-s<0,m=o.clone().add(l+(h?-1:1),x);return+(-(l+(i-s)/(h?s-m:m-s))||0)},a:function(c){return c<0?Math.ceil(c)||0:Math.floor(c)},p:function(c){return{M:x,y:w,w:C,d:y,D:g,h:u,m:f,s:r,ms:a,Q:$}[c]||String(c||"").toLowerCase().replace(/s$/,"")},u:function(c){return c===void 0}},M="en",N={};N[M]=k;var L="$isDayjsObject",F=function(c){return c instanceof K||!(!c||!c[L])},I=function c(o,i,l){var s;if(!o)return M;if(typeof o=="string"){var h=o.toLowerCase();N[h]&&(s=h),i&&(N[h]=i,s=h);var m=o.split("-");if(!s&&m.length>1)return c(m[0])}else{var D=o.name;N[D]=o,s=D}return!l&&s&&(M=s),s||!l&&M},b=function(c,o){if(F(c))return c.clone();var i=typeof o=="object"?o:{};return i.date=c,i.args=arguments,new K(i)},v=Y;v.l=I,v.i=F,v.w=function(c,o){return b(c,{locale:o.$L,utc:o.$u,x:o.$x,$offset:o.$offset})};var K=(function(){function c(i){this.$L=I(i.locale,null,!0),this.parse(i),this.$x=this.$x||i.x||{},this[L]=!0}var o=c.prototype;return o.parse=function(i){this.$d=(function(l){var s=l.date,h=l.utc;if(s===null)return new Date(NaN);if(v.u(s))return new Date;if(s instanceof Date)return new Date(s);if(typeof s=="string"&&!/Z$/i.test(s)){var m=s.match(p);if(m){var D=m[2]-1||0,_=(m[7]||"0").substring(0,3);return h?new Date(Date.UTC(m[1],D,m[3]||1,m[4]||0,m[5]||0,m[6]||0,_)):new Date(m[1],D,m[3]||1,m[4]||0,m[5]||0,m[6]||0,_)}}return new Date(s)})(i),this.init()},o.init=function(){var i=this.$d;this.$y=i.getFullYear(),this.$M=i.getMonth(),this.$D=i.getDate(),this.$W=i.getDay(),this.$H=i.getHours(),this.$m=i.getMinutes(),this.$s=i.getSeconds(),this.$ms=i.getMilliseconds()},o.$utils=function(){return v},o.isValid=function(){return this.$d.toString()!==d},o.isSame=function(i,l){var s=b(i);return this.startOf(l)<=s&&s<=this.endOf(l)},o.isAfter=function(i,l){return b(i)<this.startOf(l)},o.isBefore=function(i,l){return this.endOf(l)<b(i)},o.$g=function(i,l,s){return v.u(i)?this[l]:this.set(s,i)},o.unix=function(){return Math.floor(this.valueOf()/1e3)},o.valueOf=function(){return this.$d.getTime()},o.startOf=function(i,l){var s=this,h=!!v.u(l)||l,m=v.p(i),D=function(z,R){var H=v.w(s.$u?Date.UTC(s.$y,R,z):new Date(s.$y,R,z),s);return h?H:H.endOf(y)},_=function(z,R){return v.w(s.toDate()[z].apply(s.toDate("s"),(h?[0,0,0,0]:[23,59,59,999]).slice(R)),s)},T=this.$W,A=this.$M,U=this.$D,j="set"+(this.$u?"UTC":"");switch(m){case w:return h?D(1,0):D(31,11);case x:return h?D(1,A):D(0,A+1);case C:var q=this.$locale().weekStart||0,W=(T<q?T+7:T)-q;return D(h?U-W:U+(6-W),A);case y:case g:return _(j+"Hours",0);case u:return _(j+"Minutes",1);case f:return _(j+"Seconds",2);case r:return _(j+"Milliseconds",3);default:return this.clone()}},o.endOf=function(i){return this.startOf(i,!1)},o.$set=function(i,l){var s,h=v.p(i),m="set"+(this.$u?"UTC":""),D=(s={},s[y]=m+"Date",s[g]=m+"Date",s[x]=m+"Month",s[w]=m+"FullYear",s[u]=m+"Hours",s[f]=m+"Minutes",s[r]=m+"Seconds",s[a]=m+"Milliseconds",s)[h],_=h===y?this.$D+(l-this.$W):l;if(h===x||h===w){var T=this.clone().set(g,1);T.$d[D](_),T.init(),this.$d=T.set(g,Math.min(this.$D,T.daysInMonth())).$d}else D&&this.$d[D](_);return this.init(),this},o.set=function(i,l){return this.clone().$set(i,l)},o.get=function(i){return this[v.p(i)]()},o.add=function(i,l){var s,h=this;i=Number(i);var m=v.p(l),D=function(A){var U=b(h);return v.w(U.date(U.date()+Math.round(A*i)),h)};if(m===x)return this.set(x,this.$M+i);if(m===w)return this.set(w,this.$y+i);if(m===y)return D(1);if(m===C)return D(7);var _=(s={},s[f]=t,s[u]=e,s[r]=n,s)[m]||1,T=this.$d.getTime()+i*_;return v.w(T,this)},o.subtract=function(i,l){return this.add(-1*i,l)},o.format=function(i){var l=this,s=this.$locale();if(!this.isValid())return s.invalidDate||d;var h=i||"YYYY-MM-DDTHH:mm:ssZ",m=v.z(this),D=this.$H,_=this.$m,T=this.$M,A=s.weekdays,U=s.months,j=s.meridiem,q=function(R,H,Z,G){return R&&(R[H]||R(l,h))||Z[H].slice(0,G)},W=function(R){return v.s(D%12||12,R,"0")},z=j||function(R,H,Z){var G=R<12?"AM":"PM";return Z?G.toLowerCase():G};return h.replace(O,(function(R,H){return H||(function(Z){switch(Z){case"YY":return String(l.$y).slice(-2);case"YYYY":return v.s(l.$y,4,"0");case"M":return T+1;case"MM":return v.s(T+1,2,"0");case"MMM":return q(s.monthsShort,T,U,3);case"MMMM":return q(U,T);case"D":return l.$D;case"DD":return v.s(l.$D,2,"0");case"d":return String(l.$W);case"dd":return q(s.weekdaysMin,l.$W,A,2);case"ddd":return q(s.weekdaysShort,l.$W,A,3);case"dddd":return A[l.$W];case"H":return String(D);case"HH":return v.s(D,2,"0");case"h":return W(1);case"hh":return W(2);case"a":return z(D,_,!0);case"A":return z(D,_,!1);case"m":return String(_);case"mm":return v.s(_,2,"0");case"s":return String(l.$s);case"ss":return v.s(l.$s,2,"0");case"SSS":return v.s(l.$ms,3,"0");case"Z":return m}return null})(R)||m.replace(":","")}))},o.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},o.diff=function(i,l,s){var h,m=this,D=v.p(l),_=b(i),T=(_.utcOffset()-this.utcOffset())*t,A=this-_,U=function(){return v.m(m,_)};switch(D){case w:h=U()/12;break;case x:h=U();break;case $:h=U()/3;break;case C:h=(A-T)/6048e5;break;case y:h=(A-T)/864e5;break;case u:h=A/e;break;case f:h=A/t;break;case r:h=A/n;break;default:h=A}return s?h:v.a(h)},o.daysInMonth=function(){return this.endOf(x).$D},o.$locale=function(){return N[this.$L]},o.locale=function(i,l){if(!i)return this.$L;var s=this.clone(),h=I(i,l,!0);return h&&(s.$L=h),s},o.clone=function(){return v.w(this.$d,this)},o.toDate=function(){return new Date(this.valueOf())},o.toJSON=function(){return this.isValid()?this.toISOString():null},o.toISOString=function(){return this.$d.toISOString()},o.toString=function(){return this.$d.toUTCString()},c})(),gt=K.prototype;return b.prototype=gt,[["$ms",a],["$s",r],["$m",f],["$H",u],["$W",y],["$M",x],["$y",w],["$D",g]].forEach((function(c){gt[c[1]]=function(o){return this.$g(o,c[0],c[1])}})),b.extend=function(c,o){return c.$i||(c(o,K,b),c.$i=!0),b},b.locale=I,b.isDayjs=F,b.unix=function(c){return b(1e3*c)},b.en=N[M],b.Ls=N,b.p={},b}))});var pt=V((rt,it)=>{(function(n,t){typeof rt=="object"&&typeof it<"u"?it.exports=t():typeof define=="function"&&define.amd?define(t):(n=typeof globalThis<"u"?globalThis:n||self).dayjs_plugin_utc=t()})(rt,(function(){"use strict";var n="minute",t=/[+-]\d\d(?::?\d\d)?/g,e=/([+-]|\d\d)/g;return function(a,r,f){var u=r.prototype;f.utc=function(d){var p={date:d,utc:!0,args:arguments};return new r(p)},u.utc=function(d){var p=f(this.toDate(),{locale:this.$L,utc:!0});return d?p.add(this.utcOffset(),n):p},u.local=function(){return f(this.toDate(),{locale:this.$L,utc:!1})};var y=u.parse;u.parse=function(d){d.utc&&(this.$u=!0),this.$utils().u(d.$offset)||(this.$offset=d.$offset),y.call(this,d)};var C=u.init;u.init=function(){if(this.$u){var d=this.$d;this.$y=d.getUTCFullYear(),this.$M=d.getUTCMonth(),this.$D=d.getUTCDate(),this.$W=d.getUTCDay(),this.$H=d.getUTCHours(),this.$m=d.getUTCMinutes(),this.$s=d.getUTCSeconds(),this.$ms=d.getUTCMilliseconds()}else C.call(this)};var x=u.utcOffset;u.utcOffset=function(d,p){var O=this.$utils().u;if(O(d))return this.$u?0:O(this.$offset)?x.call(this):this.$offset;if(typeof d=="string"&&(d=(function(M){M===void 0&&(M="");var N=M.match(t);if(!N)return null;var L=(""+N[0]).match(e)||["-",0,0],F=L[0],I=60*+L[1]+ +L[2];return I===0?0:F==="+"?I:-I})(d),d===null))return this;var k=Math.abs(d)<=16?60*d:d;if(k===0)return this.utc(p);var S=this.clone();if(p)return S.$offset=k,S.$u=!1,S;var Y=this.$u?this.toDate().getTimezoneOffset():-1*this.utcOffset();return(S=this.local().add(k+Y,n)).$offset=k,S.$x.$localOffset=Y,S};var $=u.format;u.format=function(d){var p=d||(this.$u?"YYYY-MM-DDTHH:mm:ss[Z]":"");return $.call(this,p)},u.valueOf=function(){var d=this.$utils().u(this.$offset)?0:this.$offset+(this.$x.$localOffset||this.$d.getTimezoneOffset());return this.$d.valueOf()-6e4*d},u.isUTC=function(){return!!this.$u},u.toISOString=function(){return this.toDate().toISOString()},u.toString=function(){return this.toDate().toUTCString()};var w=u.toDate;u.toDate=function(d){return d==="s"&&this.$offset?f(this.format("YYYY-MM-DD HH:mm:ss:SSS")).toDate():w.call(this)};var g=u.diff;u.diff=function(d,p,O){if(d&&this.$u===d.$u)return g.call(this,d,p,O);var k=this.local(),S=f(d).local();return g.call(k,S,p,O)}}}))});var Dt=V((st,ot)=>{(function(n,t){typeof st=="object"&&typeof ot<"u"?ot.exports=t():typeof define=="function"&&define.amd?define(t):(n=typeof globalThis<"u"?globalThis:n||self).dayjs_plugin_timezone=t()})(st,(function(){"use strict";var n={year:0,month:1,day:2,hour:3,minute:4,second:5},t={};return function(e,a,r){var f,u=function($,w,g){g===void 0&&(g={});var d=new Date($),p=(function(O,k){k===void 0&&(k={});var S=k.timeZoneName||"short",Y=O+"|"+S,M=t[Y];return M||(M=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:O,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",timeZoneName:S}),t[Y]=M),M})(w,g);return p.formatToParts(d)},y=function($,w){for(var g=u($,w),d=[],p=0;p<g.length;p+=1){var O=g[p],k=O.type,S=O.value,Y=n[k];Y>=0&&(d[Y]=parseInt(S,10))}var M=d[3],N=M===24?0:M,L=d[0]+"-"+d[1]+"-"+d[2]+" "+N+":"+d[4]+":"+d[5]+":000",F=+$;return(r.utc(L).valueOf()-(F-=F%1e3))/6e4},C=a.prototype;C.tz=function($,w){$===void 0&&($=f);var g,d=this.utcOffset(),p=this.toDate(),O=p.toLocaleString("en-US",{timeZone:$}),k=Math.round((p-new Date(O))/1e3/60),S=15*-Math.round(p.getTimezoneOffset()/15)-k;if(!Number(S))g=this.utcOffset(0,w);else if(g=r(O,{locale:this.$L}).$set("millisecond",this.$ms).utcOffset(S,!0),w){var Y=g.utcOffset();g=g.add(d-Y,"minute")}return g.$x.$timezone=$,g},C.offsetName=function($){var w=this.$x.$timezone||r.tz.guess(),g=u(this.valueOf(),w,{timeZoneName:$}).find((function(d){return d.type.toLowerCase()==="timezonename"}));return g&&g.value};var x=C.startOf;C.startOf=function($,w){if(!this.$x||!this.$x.$timezone)return x.call(this,$,w);var g=r(this.format("YYYY-MM-DD HH:mm:ss:SSS"),{locale:this.$L});return x.call(g,$,w).tz(this.$x.$timezone,!0)},r.tz=function($,w,g){var d=g&&w,p=g||w||f,O=y(+r(),p);if(typeof $!="string")return r($).tz(p);var k=(function(N,L,F){var I=N-60*L*1e3,b=y(I,F);if(L===b)return[I,L];var v=y(I-=60*(b-L)*1e3,F);return b===v?[I,b]:[N-60*Math.min(b,v)*1e3,Math.max(b,v)]})(r.utc($,d).valueOf(),O,p),S=k[0],Y=k[1],M=r(S).utcOffset(Y);return M.$x.$timezone=p,M},r.tz.guess=function(){return Intl.DateTimeFormat().resolvedOptions().timeZone},r.tz.setDefault=function($){f=$}}}))});var $t=V((dt,lt)=>{(function(n,t){typeof dt=="object"&&typeof lt<"u"?lt.exports=t():typeof define=="function"&&define.amd?define(t):(n=typeof globalThis<"u"?globalThis:n||self).dayjs_plugin_isSameOrBefore=t()})(dt,(function(){"use strict";return function(n,t){t.prototype.isSameOrBefore=function(e,a){return this.isSame(e,a)||this.isBefore(e,a)}}}))});var wt=V((ut,ct)=>{(function(n,t){typeof ut=="object"&&typeof ct<"u"?ct.exports=t():typeof define=="function"&&define.amd?define(t):(n=typeof globalThis<"u"?globalThis:n||self).dayjs_plugin_isSameOrAfter=t()})(ut,(function(){"use strict";return function(n,t){t.prototype.isSameOrAfter=function(e,a){return this.isSame(e,a)||this.isAfter(e,a)}}}))});var B=J(yt(),1),bt=J(pt(),1),St=J(Dt(),1),_t=J($t(),1),Mt=J(wt(),1);B.default.extend(bt.default);B.default.extend(St.default);B.default.extend(_t.default);B.default.extend(Mt.default);function E(n){if(!n)return null;if(B.default.isDayjs(n))return n.startOf("day");let t=(0,B.default)(n);return t.isValid()?t.startOf("day"):(console.warn("Invalid date input:",n),null)}function P(n){let t=E(n);return t?t.format("YYYY-MM-DD"):""}function Q(){return(0,B.default)().startOf("day")}function ft(n,t){let e=E(n),a=E(t);if(!e||!a||!e.isValid()||!a.isValid())return console.warn("Invalid date range:",n,t),[];let[r,f]=e.isAfter(a)?[a,e]:[e,a],u=[],y=r;for(;y.isSameOrBefore(f);)u.push(y.format("YYYY-MM-DD")),y=y.add(1,"day");return u}function kt(n,t){let e=P(n);return t.includes(e)}var X=class{constructor(t){this.form=t,this.validationType=this.form.dataset.validation,this.today=Q()}validateDate(t){try{let e=E(t);if(!e)return{valid:!1,reason:"Invalid date format"};switch(this.validationType){case"future":return this.validateFuture(e);case"past":return this.validatePast(e);case"range":return this.validateRange(e);case"year":return this.validateYear(e);case"custom":return this.validateCustomRange(e);case"weekdays":return this.validateWeekdays(e);case"weekends":return this.validateWeekends(e);case"days":return this.validateSpecificDays(e);case"blackout":return this.validateBlackout(e);case"advance-notice":return this.validateAdvanceNotice(e);case"booking-window":return this.validateBookingWindow(e);case"business":return this.validateBusinessRules(e);case"none":default:return{valid:!0,reason:""}}}catch{return{valid:!1,reason:"Date parsing error"}}}validateFuture(t){return t.isSameOrAfter(this.today)?{valid:!0,reason:""}:{valid:!1,reason:"Only future dates are allowed"}}validatePast(t){return t.isSameOrBefore(this.today)?{valid:!0,reason:""}:{valid:!1,reason:"Only past dates are allowed"}}validateRange(t){let e=this.form.dataset.rangeStart?E(this.form.dataset.rangeStart):null,a=this.form.dataset.rangeEnd?E(this.form.dataset.rangeEnd):null;return!e&&!a?{valid:!1,reason:"Range validation requires start or end date"}:e&&t.isBefore(e)?{valid:!1,reason:`Date must be after ${this.formatDate(e)}`}:a&&t.isAfter(a)?{valid:!1,reason:`Date must be before ${this.formatDate(a)}`}:{valid:!0,reason:""}}validateYear(t){let e=parseInt(this.form.dataset.year);return e?t.year()===e?{valid:!0,reason:""}:{valid:!1,reason:`Only dates in ${e} are allowed`}:{valid:!1,reason:"Year validation requires data-year attribute"}}validateCustomRange(t){let e=this.form.dataset.minDate?E(this.form.dataset.minDate):null,a=this.form.dataset.maxDate?E(this.form.dataset.maxDate):null;return e&&t.isBefore(e)?{valid:!1,reason:`Date must be after ${this.formatDate(e)}`}:a&&t.isAfter(a)?{valid:!1,reason:`Date must be before ${this.formatDate(a)}`}:{valid:!0,reason:""}}validateWeekdays(t){let e=t.day();return e>=1&&e<=5?{valid:!0,reason:""}:{valid:!1,reason:"Only weekdays are allowed"}}validateWeekends(t){let e=t.day();return e===0||e===6?{valid:!0,reason:""}:{valid:!1,reason:"Only weekends are allowed"}}validateSpecificDays(t){let e=this.form.dataset.allowedDays?.split(",").map(u=>parseInt(u.trim()));if(!e||e.length===0)return{valid:!1,reason:"No allowed days specified"};let a=t.day();if(e.includes(a))return{valid:!0,reason:""};let r=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];return{valid:!1,reason:`Only ${e.map(u=>r[u]).join(", ")} are allowed`}}validateBlackout(t){let e=this.form.dataset.blackoutDates?.split(",").map(f=>f.trim())||[],a=this.form.dataset.blackoutRanges?.split(",").map(f=>f.trim())||[],r=P(t);if(e.includes(r))return{valid:!1,reason:"Date is not available"};for(let f of a){let[u,y]=f.split(":");if(u&&y){let C=E(u),x=E(y);if(t.isSameOrAfter(C)&&t.isSameOrBefore(x))return{valid:!1,reason:"Date is in blackout period"}}}return{valid:!0,reason:""}}validateAdvanceNotice(t){let e=parseInt(this.form.dataset.minAdvanceDays)||0,a=this.today.add(e,"day");return t.isSameOrAfter(a)?{valid:!0,reason:""}:{valid:!1,reason:`Requires ${e} days advance notice`}}validateBookingWindow(t){let e=parseInt(this.form.dataset.maxAdvanceDays)||365,a=this.today.add(e,"day");return t.isSameOrBefore(a)?{valid:!0,reason:""}:{valid:!1,reason:`Cannot book more than ${e} days in advance`}}validateBusinessRules(t){let e=this.validateAdvanceNotice(t);if(!e.valid)return e;let a=this.validateBookingWindow(t);if(!a.valid)return a;let r=this.validateSpecificDays(t);return r.valid?{valid:!0,reason:""}:r}needsRevalidation(){return this.form.dataset.maxSelections||this.validationType==="consecutive"}formatDate(t){return new Intl.DateTimeFormat("en-GB",{day:"numeric",month:"long",year:"numeric"}).format(t.toDate())}};function ht(n,t){let e=n.closest(".dgwltd-calendar__day"),a=e.querySelector(".govuk-checkboxes__label");n.disabled=!0,n.setAttribute("aria-describedby",n.id+"-disabled-reason"),e.classList.add("dgwltd-calendar__day--disabled");let r=e.querySelector(".dgwltd-calendar__disabled-reason");r||(r=document.createElement("span"),r.className="dgwltd-calendar__disabled-reason govuk-visually-hidden",r.id=n.id+"-disabled-reason",e.appendChild(r)),r.textContent=t,a.setAttribute("title",t)}function mt(n){let t=n.closest(".dgwltd-calendar__day"),e=t.querySelector(".govuk-checkboxes__label"),a=t.querySelector(".dgwltd-calendar__disabled-reason");n.disabled=!1,n.removeAttribute("aria-describedby"),t.classList.remove("dgwltd-calendar__day--disabled"),a&&a.remove(),e.removeAttribute("title")}function xt(n,t){t.forEach(e=>{let a=n.validateDate(e.value);a.valid?mt(e):ht(e,a.reason)})}var tt=class{constructor(t,e){this.form=t,this.validator=e,this.lastSelectedDate=null,this.isRangeMode=!1,this.previewRange=[],this.elements=this.cacheElements(),this.init()}cacheElements(){return{checkboxes:this.form.querySelectorAll('input[name="selected_dates[]'),hint:this.form.querySelector("#calendar-hint")}}init(){this.elements.checkboxes.forEach(t=>{t.addEventListener("click",e=>this.handleDateClick(e,t)),t.addEventListener("mouseenter",e=>this.handleDateHover(e,t)),t.addEventListener("mouseleave",()=>this.clearRangePreview())}),this.boundExitHandler=this.handleOutsideClick.bind(this),document.addEventListener("click",this.boundExitHandler)}handleOutsideClick(t){this.form.contains(t.target)||this.exitRangeMode()}destroy(){document.removeEventListener("click",this.boundExitHandler)}handleDateClick(t,e){if(e.disabled)return t.preventDefault(),!1;let a=E(e.value);if(this.isRangeMode&&this.lastSelectedDate){this.selectDateRange(this.lastSelectedDate,a,e),this.exitRangeMode();return}e.checked?(this.lastSelectedDate=a,this.isRangeMode=!0,this.showRangeStartFeedback(e)):this.exitRangeMode()}handleDateHover(t,e){if(!this.isRangeMode||!this.lastSelectedDate||e.disabled)return;let a=E(e.value);this.showRangePreview(this.lastSelectedDate,a)}selectDateRange(t,e){t.isAfter(e)&&([t,e]=[e,t]);let a=new Set(ft(t,e)),r=0;this.elements.checkboxes.forEach(f=>{a.has(f.value)&&!f.disabled&&(this.setCheckboxSelected(f),r++)}),this.clearRangePreview()}setCheckboxSelected(t){t.checked=!0,t.setAttribute("checked","checked"),t.dispatchEvent(new Event("change",{bubbles:!0}))}showRangePreview(t,e){this.clearRangePreview(),t.isAfter(e)&&([t,e]=[e,t]);let a=ft(t,e);this.form.querySelectorAll('input[name="selected_dates[]"]').forEach(f=>{let u=f.value;kt(u,a)&&!f.disabled&&f.closest(".dgwltd-calendar__day").classList.add("dgwltd-calendar__day--preview-range")}),this.previewRange=a}clearRangePreview(){this.form.querySelectorAll(".dgwltd-calendar__day--preview-range").forEach(e=>{e.classList.remove("dgwltd-calendar__day--preview-range")}),this.previewRange=[]}showRangeStartFeedback(t){t.closest(".dgwltd-calendar__day").classList.add("dgwltd-calendar__day--range-start"),this.showRangeInstruction()}showRangeInstruction(){let t=this.form.querySelector(".dgwltd-calendar__range-instruction");t&&t.remove();let e=document.createElement("div");e.className="dgwltd-calendar__range-instruction",e.setAttribute("role","status"),e.textContent="Range start selected. Click another date to complete the range.";let a=this.form.querySelector("#calendar-hint");a&&a.appendChild(e)}exitRangeMode(){this.isRangeMode=!1,this.lastSelectedDate=null,this.clearRangePreview(),this.clearRangeStartFeedback(),this.clearRangeInstruction()}clearRangeStartFeedback(){this.form.querySelectorAll(".dgwltd-calendar__day--range-start").forEach(e=>{e.classList.remove("dgwltd-calendar__day--range-start")})}clearRangeInstruction(){let t=this.form.querySelector(".dgwltd-calendar__range-instruction");t&&t.remove()}};function Ot(n){let t=n.querySelector("#calendar-hint");if(t){let e=document.createElement("div");e.className="dgwltd-calendar__range-hint",e.innerHTML='<div class="govuk-phase-banner"><p class="govuk-phase-banner__content"><strong class="govuk-tag govuk-phase-banner__content__tag">Tip</strong> <span class="govuk-phase-banner__text">Click two dates to select a date range</span></p></div>',t.appendChild(e)}}var et=class{constructor(t,e){this.form=t,this.validator=e,this.today=Q(),this.init()}init(){this.addNavigationControls(),this.addKeyboardShortcuts()}addNavigationControls(){let t=this.form.querySelector(".govuk-pagination");if(!t)return;let e=document.createElement("div");e.className="dgwltd-calendar__quick-nav";let a=this.createTodayButton();e.appendChild(a);let r=this.createNextAvailableButton();e.appendChild(r);let f=this.createShortcutsHint();e.appendChild(f),t.parentNode.insertBefore(e,t)}createTodayButton(){let t=document.createElement("button");return t.type="button",t.className="govuk-button govuk-button--secondary dgwltd-calendar__today-btn",t.textContent="Jump to Today",t.setAttribute("title","Navigate to current month and highlight today"),t.addEventListener("click",e=>{e.preventDefault(),this.jumpToToday()}),t}createNextAvailableButton(){let t=document.createElement("button");return t.type="button",t.className="govuk-button govuk-button--secondary dgwltd-calendar__next-available-btn",t.textContent="Next Available",t.setAttribute("title","Find and navigate to next available date"),t.addEventListener("click",e=>{e.preventDefault(),this.findNextAvailableDate()}),t}createShortcutsHint(){let t=document.createElement("div");return t.className="dgwltd-calendar__shortcuts-hint",t.innerHTML="<small><strong>Shortcuts:</strong> T = Today, N = Next Available</small>",t}addKeyboardShortcuts(){document.addEventListener("keydown",t=>{if(this.form.contains(document.activeElement)&&!(t.target.tagName==="INPUT"&&t.target.type==="text"))switch(t.key.toLowerCase()){case"t":t.preventDefault(),this.jumpToToday();break;case"n":t.preventDefault(),this.findNextAvailableDate();break;case"arrowleft":t.preventDefault(),this.navigateToPreviousMonth();break;case"arrowright":t.preventDefault(),this.navigateToNextMonth();break}})}jumpToToday(){let t=this.getCurrentMonthFromUrl(),e=this.getCurrentYearFromUrl(),a=this.today.month()+1,r=this.today.year();t!==a||e!==r?this.navigateToMonth(r,a):this.highlightToday(),this.showNavigationFeedback(`Navigated to ${this.formatDate(this.today)}`)}findNextAvailableDate(){let t=this.findNextValidDate();if(t){let e=t.month()+1,a=t.year(),r=this.getCurrentMonthFromUrl(),f=this.getCurrentYearFromUrl();if(r!==e||f!==a){let u=P(t),y=this.addHighlightParam(this.buildNavigationUrl(a,e),u);window.location.href=y}else this.highlightDate(t),this.showNavigationFeedback(`Next available date: ${this.formatDate(t)}`)}else this.showNavigationFeedback("No available dates found in the next 365 days","error")}findNextValidDate(){let t=this.today.add(1,"day");for(let e=0;e<365;e++){let a=P(t);if(this.validator.validateDate(a).valid)return t;t=t.add(1,"day")}return null}highlightToday(){let t=P(this.today),e=this.form.querySelector(`input[value="${t}"]`);e&&this.highlightCheckbox(e,"today")}highlightDate(t){let e=P(t),a=this.form.querySelector(`input[value="${e}"]`);a&&(this.highlightCheckbox(a,"next-available"),a.scrollIntoView({behavior:"smooth",block:"center"}))}highlightCheckbox(t,e){let a=t.closest(".dgwltd-calendar__day");a.classList.remove("dgwltd-calendar__day--highlight-today","dgwltd-calendar__day--highlight-next");let r=e==="today"?"dgwltd-calendar__day--highlight-today":"dgwltd-calendar__day--highlight-next";a.classList.add(r),setTimeout(()=>{a.classList.remove(r)},3e3)}navigateToPreviousMonth(){let t=this.getCurrentMonthFromUrl(),e=this.getCurrentYearFromUrl(),a=t-1,r=e;a<1&&(a=12,r=e-1),this.navigateToMonth(r,a)}navigateToNextMonth(){let t=this.getCurrentMonthFromUrl(),e=this.getCurrentYearFromUrl(),a=t+1,r=e;a>12&&(a=1,r=e+1),this.navigateToMonth(r,a)}navigateToMonth(t,e){let a=this.buildNavigationUrl(t,e);window.location.href=a}buildNavigationUrl(t,e){let a=this.removeQueryParams(window.location.href,["cal_month","cal_year","highlight"]),r=a.includes("?")?"&":"?";return`${a}${r}cal_year=${t}&cal_month=${e}`}addHighlightParam(t,e){let a=t.includes("?")?"&":"?";return`${t}${a}highlight=${e}`}getCurrentMonthFromUrl(){let t=new URLSearchParams(window.location.search);return parseInt(t.get("cal_month"))||new Date().getMonth()+1}getCurrentYearFromUrl(){let t=new URLSearchParams(window.location.search);return parseInt(t.get("cal_year"))||new Date().getFullYear()}removeQueryParams(t,e){let a=new URL(t);return e.forEach(r=>{a.searchParams.delete(r)}),a.toString()}showNavigationFeedback(t,e="info"){let a=this.form.querySelector(".dgwltd-calendar__nav-feedback");a&&a.remove();let r=document.createElement("div");r.className=`dgwltd-calendar__nav-feedback dgwltd-calendar__nav-feedback--${e}`,r.setAttribute("role","status"),r.textContent=t;let f=this.form.querySelector("#calendar-hint");f&&f.appendChild(r),setTimeout(()=>{r.parentNode&&r.remove()},3e3)}formatDate(t){return new Intl.DateTimeFormat("en-GB",{weekday:"long",day:"numeric",month:"long",year:"numeric"}).format(t.toDate())}};function Tt(n){let e=new URLSearchParams(window.location.search).get("highlight");if(e){let a=n.querySelector(`input[value="${e}"]`);if(a){let r=a.closest(".dgwltd-calendar__day");r.classList.add("dgwltd-calendar__day--highlight-next"),a.scrollIntoView({behavior:"smooth",block:"center"}),setTimeout(()=>{r.classList.remove("dgwltd-calendar__day--highlight-next")},5e3)}}}document.addEventListener("DOMContentLoaded",function(){let n=document.querySelector(".dgwltd-calendar__form");if(!n)return;let t=new X(n),e=n.querySelectorAll('input[name="selected_dates[]"]');e.forEach(y=>{let C=t.validateDate(y.value);C.valid?mt(y):ht(y,C.reason)});let a=n.dataset.rangeSelection==="true",r=null;a&&(r=new tt(n,t),Ot(n));let f=n.dataset.navigation==="true",u=null;f&&(u=new et(n,t)),Tt(n),n.addEventListener("change",function(){t.needsRevalidation()&&xt(t,e)}),console.log("\u2705 Enhanced Calendar System initialized:",{validation:t.validationType,rangeSelection:a,navigation:f,totalDates:e.length,validDates:Array.from(e).filter(y=>!y.disabled).length})});})();
