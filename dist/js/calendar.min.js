(()=>{var gt=Object.create;var it=Object.defineProperty;var vt=Object.getOwnPropertyDescriptor;var yt=Object.getOwnPropertyNames;var pt=Object.getPrototypeOf,Dt=Object.prototype.hasOwnProperty;var bt=(i,t)=>()=>(t||i((t={exports:{}}).exports,t),t.exports);var wt=(i,t,e,a)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of yt(t))!Dt.call(i,n)&&n!==e&&it(i,n,{get:()=>t[n],enumerable:!(a=vt(t,n))||a.enumerable});return i};var St=(i,t,e)=>(e=i!=null?gt(pt(i)):{},wt(t||!i||!i.__esModule?it(e,"default",{value:i,enumerable:!0}):e,i));var st=bt((G,Z)=>{(function(i,t){typeof G=="object"&&typeof Z<"u"?Z.exports=t():typeof define=="function"&&define.amd?define(t):(i=typeof globalThis<"u"?globalThis:i||self).dayjs=t()})(G,(function(){"use strict";var i=1e3,t=6e4,e=36e5,a="millisecond",n="second",d="minute",f="hour",g="day",k="week",p="month",R="quarter",M="year",T="date",at="Invalid Date",ut=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,ht=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,ft={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(c){var o=["th","st","nd","rd"],r=c%100;return"["+c+(o[(r-20)%10]||o[r]||o[0])+"]"}},J=function(c,o,r){var l=String(c);return!l||l.length>=o?c:""+Array(o+1-l.length).join(r)+c},mt={s:J,z:function(c){var o=-c.utcOffset(),r=Math.abs(o),l=Math.floor(r/60),s=r%60;return(o<=0?"+":"-")+J(l,2,"0")+":"+J(s,2,"0")},m:function c(o,r){if(o.date()<r.date())return-c(r,o);var l=12*(r.year()-o.year())+(r.month()-o.month()),s=o.clone().add(l,p),u=r-s<0,h=o.clone().add(l+(u?-1:1),p);return+(-(l+(r-s)/(u?s-h:h-s))||0)},a:function(c){return c<0?Math.ceil(c)||0:Math.floor(c)},p:function(c){return{M:p,y:M,w:k,d:g,D:T,h:f,m:d,s:n,ms:a,Q:R}[c]||String(c||"").toLowerCase().replace(/s$/,"")},u:function(c){return c===void 0}},L="en",C={};C[L]=ft;var nt="$isDayjsObject",K=function(c){return c instanceof q||!(!c||!c[nt])},F=function c(o,r,l){var s;if(!o)return L;if(typeof o=="string"){var u=o.toLowerCase();C[u]&&(s=u),r&&(C[u]=r,s=u);var h=o.split("-");if(!s&&h.length>1)return c(h[0])}else{var v=o.name;C[v]=o,s=v}return!l&&s&&(L=s),s||!l&&L},D=function(c,o){if(K(c))return c.clone();var r=typeof o=="object"?o:{};return r.date=c,r.args=arguments,new q(r)},m=mt;m.l=F,m.i=K,m.w=function(c,o){return D(c,{locale:o.$L,utc:o.$u,x:o.$x,$offset:o.$offset})};var q=(function(){function c(r){this.$L=F(r.locale,null,!0),this.parse(r),this.$x=this.$x||r.x||{},this[nt]=!0}var o=c.prototype;return o.parse=function(r){this.$d=(function(l){var s=l.date,u=l.utc;if(s===null)return new Date(NaN);if(m.u(s))return new Date;if(s instanceof Date)return new Date(s);if(typeof s=="string"&&!/Z$/i.test(s)){var h=s.match(ut);if(h){var v=h[2]-1||0,y=(h[7]||"0").substring(0,3);return u?new Date(Date.UTC(h[1],v,h[3]||1,h[4]||0,h[5]||0,h[6]||0,y)):new Date(h[1],v,h[3]||1,h[4]||0,h[5]||0,h[6]||0,y)}}return new Date(s)})(r),this.init()},o.init=function(){var r=this.$d;this.$y=r.getFullYear(),this.$M=r.getMonth(),this.$D=r.getDate(),this.$W=r.getDay(),this.$H=r.getHours(),this.$m=r.getMinutes(),this.$s=r.getSeconds(),this.$ms=r.getMilliseconds()},o.$utils=function(){return m},o.isValid=function(){return this.$d.toString()!==at},o.isSame=function(r,l){var s=D(r);return this.startOf(l)<=s&&s<=this.endOf(l)},o.isAfter=function(r,l){return D(r)<this.startOf(l)},o.isBefore=function(r,l){return this.endOf(l)<D(r)},o.$g=function(r,l,s){return m.u(r)?this[l]:this.set(s,r)},o.unix=function(){return Math.floor(this.valueOf()/1e3)},o.valueOf=function(){return this.$d.getTime()},o.startOf=function(r,l){var s=this,u=!!m.u(l)||l,h=m.p(r),v=function(I,_){var E=m.w(s.$u?Date.UTC(s.$y,_,I):new Date(s.$y,_,I),s);return u?E:E.endOf(g)},y=function(I,_){return m.w(s.toDate()[I].apply(s.toDate("s"),(u?[0,0,0,0]:[23,59,59,999]).slice(_)),s)},b=this.$W,S=this.$M,$=this.$D,N="set"+(this.$u?"UTC":"");switch(h){case M:return u?v(1,0):v(31,11);case p:return u?v(1,S):v(0,S+1);case k:var A=this.$locale().weekStart||0,O=(b<A?b+7:b)-A;return v(u?$-O:$+(6-O),S);case g:case T:return y(N+"Hours",0);case f:return y(N+"Minutes",1);case d:return y(N+"Seconds",2);case n:return y(N+"Milliseconds",3);default:return this.clone()}},o.endOf=function(r){return this.startOf(r,!1)},o.$set=function(r,l){var s,u=m.p(r),h="set"+(this.$u?"UTC":""),v=(s={},s[g]=h+"Date",s[T]=h+"Date",s[p]=h+"Month",s[M]=h+"FullYear",s[f]=h+"Hours",s[d]=h+"Minutes",s[n]=h+"Seconds",s[a]=h+"Milliseconds",s)[u],y=u===g?this.$D+(l-this.$W):l;if(u===p||u===M){var b=this.clone().set(T,1);b.$d[v](y),b.init(),this.$d=b.set(T,Math.min(this.$D,b.daysInMonth())).$d}else v&&this.$d[v](y);return this.init(),this},o.set=function(r,l){return this.clone().$set(r,l)},o.get=function(r){return this[m.p(r)]()},o.add=function(r,l){var s,u=this;r=Number(r);var h=m.p(l),v=function(S){var $=D(u);return m.w($.date($.date()+Math.round(S*r)),u)};if(h===p)return this.set(p,this.$M+r);if(h===M)return this.set(M,this.$y+r);if(h===g)return v(1);if(h===k)return v(7);var y=(s={},s[d]=t,s[f]=e,s[n]=i,s)[h]||1,b=this.$d.getTime()+r*y;return m.w(b,this)},o.subtract=function(r,l){return this.add(-1*r,l)},o.format=function(r){var l=this,s=this.$locale();if(!this.isValid())return s.invalidDate||at;var u=r||"YYYY-MM-DDTHH:mm:ssZ",h=m.z(this),v=this.$H,y=this.$m,b=this.$M,S=s.weekdays,$=s.months,N=s.meridiem,A=function(_,E,Y,B){return _&&(_[E]||_(l,u))||Y[E].slice(0,B)},O=function(_){return m.s(v%12||12,_,"0")},I=N||function(_,E,Y){var B=_<12?"AM":"PM";return Y?B.toLowerCase():B};return u.replace(ht,(function(_,E){return E||(function(Y){switch(Y){case"YY":return String(l.$y).slice(-2);case"YYYY":return m.s(l.$y,4,"0");case"M":return b+1;case"MM":return m.s(b+1,2,"0");case"MMM":return A(s.monthsShort,b,$,3);case"MMMM":return A($,b);case"D":return l.$D;case"DD":return m.s(l.$D,2,"0");case"d":return String(l.$W);case"dd":return A(s.weekdaysMin,l.$W,S,2);case"ddd":return A(s.weekdaysShort,l.$W,S,3);case"dddd":return S[l.$W];case"H":return String(v);case"HH":return m.s(v,2,"0");case"h":return O(1);case"hh":return O(2);case"a":return I(v,y,!0);case"A":return I(v,y,!1);case"m":return String(y);case"mm":return m.s(y,2,"0");case"s":return String(l.$s);case"ss":return m.s(l.$s,2,"0");case"SSS":return m.s(l.$ms,3,"0");case"Z":return h}return null})(_)||h.replace(":","")}))},o.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},o.diff=function(r,l,s){var u,h=this,v=m.p(l),y=D(r),b=(y.utcOffset()-this.utcOffset())*t,S=this-y,$=function(){return m.m(h,y)};switch(v){case M:u=$()/12;break;case p:u=$();break;case R:u=$()/3;break;case k:u=(S-b)/6048e5;break;case g:u=(S-b)/864e5;break;case f:u=S/e;break;case d:u=S/t;break;case n:u=S/i;break;default:u=S}return s?u:m.a(u)},o.daysInMonth=function(){return this.endOf(p).$D},o.$locale=function(){return C[this.$L]},o.locale=function(r,l){if(!r)return this.$L;var s=this.clone(),u=F(r,l,!0);return u&&(s.$L=u),s},o.clone=function(){return m.w(this.$d,this)},o.toDate=function(){return new Date(this.valueOf())},o.toJSON=function(){return this.isValid()?this.toISOString():null},o.toISOString=function(){return this.$d.toISOString()},o.toString=function(){return this.$d.toUTCString()},c})(),rt=q.prototype;return D.prototype=rt,[["$ms",a],["$s",n],["$m",d],["$H",f],["$W",g],["$M",p],["$y",M],["$D",T]].forEach((function(c){rt[c[1]]=function(o){return this.$g(o,c[0],c[1])}})),D.extend=function(c,o){return c.$i||(c(o,q,D),c.$i=!0),D},D.locale=F,D.isDayjs=K,D.unix=function(c){return D(1e3*c)},D.en=C[L],D.Ls=C,D.p={},D}))});var P=St(st(),1);function w(i){if(!i)return null;if(P.default.isDayjs(i))return i.startOf("day");let t=(0,P.default)(i);return t.isValid()?t.startOf("day"):(console.warn("Invalid date input:",i),null)}function x(i){let t=w(i);return t?t.format("YYYY-MM-DD"):""}function U(){return(0,P.default)().startOf("day")}function Q(i,t){let e=w(i),a=w(t);if(!e||!a||!e.isValid()||!a.isValid())return console.warn("Invalid date range:",i,t),[];let[n,d]=e.isAfter(a)?[a,e]:[e,a],f=[],g=n;for(;!g.isAfter(d);)f.push(g.format("YYYY-MM-DD")),g=g.add(1,"day");return f}function ot(i,t){let e=x(i);return t.includes(e)}var H=class{constructor(t){this.form=t,this.validationType=this.form.dataset.validation,this.today=U()}validateDate(t){try{let e=w(t);if(!e)return{valid:!1,reason:"Invalid date format"};switch(this.validationType){case"future":return this.validateFuture(e);case"past":return this.validatePast(e);case"range":return this.validateRange(e);case"year":return this.validateYear(e);case"custom":return this.validateCustomRange(e);case"weekdays":return this.validateWeekdays(e);case"weekends":return this.validateWeekends(e);case"days":return this.validateSpecificDays(e);case"blackout":return this.validateBlackout(e);case"advance-notice":return this.validateAdvanceNotice(e);case"booking-window":return this.validateBookingWindow(e);case"business":return this.validateBusinessRules(e);case"none":default:return{valid:!0,reason:""}}}catch{return{valid:!1,reason:"Date parsing error"}}}validateFuture(t){return t.isBefore(this.today)?{valid:!1,reason:"Only future dates are allowed"}:{valid:!0,reason:""}}validatePast(t){return t.isAfter(this.today)?{valid:!1,reason:"Only past dates are allowed"}:{valid:!0,reason:""}}validateRange(t){let e=this.form.dataset.rangeStart?w(this.form.dataset.rangeStart):null,a=this.form.dataset.rangeEnd?w(this.form.dataset.rangeEnd):null;return!e&&!a?{valid:!1,reason:"Range validation requires start or end date"}:e&&t.isBefore(e)?{valid:!1,reason:`Date must be after ${this.formatDate(e)}`}:a&&t.isAfter(a)?{valid:!1,reason:`Date must be before ${this.formatDate(a)}`}:{valid:!0,reason:""}}validateYear(t){let e=parseInt(this.form.dataset.year);return e?t.year()===e?{valid:!0,reason:""}:{valid:!1,reason:`Only dates in ${e} are allowed`}:{valid:!1,reason:"Year validation requires data-year attribute"}}validateCustomRange(t){let e=this.form.dataset.minDate?w(this.form.dataset.minDate):null,a=this.form.dataset.maxDate?w(this.form.dataset.maxDate):null;return e&&t.isBefore(e)?{valid:!1,reason:`Date must be after ${this.formatDate(e)}`}:a&&t.isAfter(a)?{valid:!1,reason:`Date must be before ${this.formatDate(a)}`}:{valid:!0,reason:""}}validateWeekdays(t){let e=t.day();return e>=1&&e<=5?{valid:!0,reason:""}:{valid:!1,reason:"Only weekdays are allowed"}}validateWeekends(t){let e=t.day();return e===0||e===6?{valid:!0,reason:""}:{valid:!1,reason:"Only weekends are allowed"}}validateSpecificDays(t){let e=this.form.dataset.allowedDays?.split(",").map(f=>parseInt(f.trim()));if(!e||e.length===0)return{valid:!1,reason:"No allowed days specified"};let a=t.day();if(e.includes(a))return{valid:!0,reason:""};let n=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];return{valid:!1,reason:`Only ${e.map(f=>n[f]).join(", ")} are allowed`}}validateBlackout(t){let e=this.form.dataset.blackoutDates?.split(",").map(d=>d.trim())||[],a=this.form.dataset.blackoutRanges?.split(",").map(d=>d.trim())||[],n=x(t);if(e.includes(n))return{valid:!1,reason:"Date is not available"};for(let d of a){let[f,g]=d.split(":");if(f&&g){let k=w(f),p=w(g);if(!t.isBefore(k)&&!t.isAfter(p))return{valid:!1,reason:"Date is in blackout period"}}}return{valid:!0,reason:""}}validateAdvanceNotice(t){let e=parseInt(this.form.dataset.minAdvanceDays)||0,a=this.today.add(e,"day");return t.isBefore(a)?{valid:!1,reason:`Requires ${e} days advance notice`}:{valid:!0,reason:""}}validateBookingWindow(t){let e=parseInt(this.form.dataset.maxAdvanceDays)||365,a=this.today.add(e,"day");return t.isAfter(a)?{valid:!1,reason:`Cannot book more than ${e} days in advance`}:{valid:!0,reason:""}}validateBusinessRules(t){let e=this.validateAdvanceNotice(t);if(!e.valid)return e;let a=this.validateBookingWindow(t);if(!a.valid)return a;let n=this.validateSpecificDays(t);return n.valid?{valid:!0,reason:""}:n}needsRevalidation(){return this.form.dataset.maxSelections||this.validationType==="consecutive"}formatDate(t){return new Intl.DateTimeFormat("en-GB",{day:"numeric",month:"long",year:"numeric"}).format(t.toDate())}};function X(i,t){let e=i.closest(".dgwltd-calendar__day"),a=e.querySelector(".govuk-checkboxes__label");i.disabled=!0,i.setAttribute("aria-describedby",i.id+"-disabled-reason"),e.classList.add("dgwltd-calendar__day--disabled");let n=e.querySelector(".dgwltd-calendar__disabled-reason");n||(n=document.createElement("span"),n.className="dgwltd-calendar__disabled-reason govuk-visually-hidden",n.id=i.id+"-disabled-reason",e.appendChild(n)),n.textContent=t,a.setAttribute("title",t)}function tt(i){let t=i.closest(".dgwltd-calendar__day"),e=t.querySelector(".govuk-checkboxes__label"),a=t.querySelector(".dgwltd-calendar__disabled-reason");i.disabled=!1,i.removeAttribute("aria-describedby"),t.classList.remove("dgwltd-calendar__day--disabled"),a&&a.remove(),e.removeAttribute("title")}function W(i,t){t.forEach(e=>{let a=i.validateDate(e.value);a.valid?tt(e):X(e,a.reason)})}var j=class{constructor(t,e){this.form=t,this.validator=e,this.lastSelectedDate=null,this.isRangeMode=!1,this.previewRange=[],this.elements=this.cacheElements(),this.init()}cacheElements(){return{checkboxes:this.form.querySelectorAll('input[name="selected_dates[]'),hint:this.form.querySelector("#calendar-hint")}}init(){this.elements.checkboxes.forEach(t=>{t.addEventListener("click",e=>this.handleDateClick(e,t)),t.addEventListener("mouseenter",e=>this.handleDateHover(e,t)),t.addEventListener("mouseleave",()=>this.clearRangePreview())}),this.boundExitHandler=this.handleOutsideClick.bind(this),document.addEventListener("click",this.boundExitHandler)}handleOutsideClick(t){this.form.contains(t.target)||this.exitRangeMode()}destroy(){document.removeEventListener("click",this.boundExitHandler)}handleDateClick(t,e){if(e.disabled)return t.preventDefault(),!1;let a=w(e.value);if(this.isRangeMode&&this.lastSelectedDate){this.selectDateRange(this.lastSelectedDate,a,e),this.exitRangeMode();return}e.checked?(this.lastSelectedDate=a,this.isRangeMode=!0,this.showRangeStartFeedback(e)):this.exitRangeMode()}handleDateHover(t,e){if(!this.isRangeMode||!this.lastSelectedDate||e.disabled)return;let a=w(e.value);this.showRangePreview(this.lastSelectedDate,a)}selectDateRange(t,e){t.isAfter(e)&&([t,e]=[e,t]);let a=new Set(Q(t,e)),n=0;this.elements.checkboxes.forEach(d=>{a.has(d.value)&&!d.disabled&&(this.setCheckboxSelected(d),n++)}),this.clearRangePreview()}setCheckboxSelected(t){t.checked=!0,t.setAttribute("checked","checked"),t.dispatchEvent(new Event("change",{bubbles:!0}))}showRangePreview(t,e){this.clearRangePreview(),t.isAfter(e)&&([t,e]=[e,t]);let a=Q(t,e);this.form.querySelectorAll('input[name="selected_dates[]"]').forEach(d=>{let f=d.value;ot(f,a)&&!d.disabled&&d.closest(".dgwltd-calendar__day").classList.add("dgwltd-calendar__day--preview-range")}),this.previewRange=a}clearRangePreview(){this.form.querySelectorAll(".dgwltd-calendar__day--preview-range").forEach(e=>{e.classList.remove("dgwltd-calendar__day--preview-range")}),this.previewRange=[]}showRangeStartFeedback(t){t.closest(".dgwltd-calendar__day").classList.add("dgwltd-calendar__day--range-start"),this.showRangeInstruction()}showRangeInstruction(){let t=this.form.querySelector(".dgwltd-calendar__range-instruction");t&&t.remove();let e=document.createElement("div");e.className="dgwltd-calendar__range-instruction",e.setAttribute("role","status"),e.textContent="Range start selected. Click another date to complete the range.";let a=this.form.querySelector("#calendar-hint");a&&a.appendChild(e)}exitRangeMode(){this.isRangeMode=!1,this.lastSelectedDate=null,this.clearRangePreview(),this.clearRangeStartFeedback(),this.clearRangeInstruction()}clearRangeStartFeedback(){this.form.querySelectorAll(".dgwltd-calendar__day--range-start").forEach(e=>{e.classList.remove("dgwltd-calendar__day--range-start")})}clearRangeInstruction(){let t=this.form.querySelector(".dgwltd-calendar__range-instruction");t&&t.remove()}};function lt(i){let t=i.querySelector("#calendar-hint");if(t){let e=document.createElement("div");e.className="dgwltd-calendar__range-hint",e.innerHTML='<div class="govuk-phase-banner"><p class="govuk-phase-banner__content"><strong class="govuk-tag govuk-phase-banner__content__tag">Tip</strong> <span class="govuk-phase-banner__text">Click two dates to select a date range</span></p></div>',t.appendChild(e)}}var V=class{constructor(t,e){this.form=t,this.validator=e,this.today=U(),this.init()}init(){this.addNavigationControls(),this.addKeyboardShortcuts()}addNavigationControls(){let t=this.form.querySelector(".govuk-pagination");if(!t)return;let e=document.createElement("div");e.className="dgwltd-calendar__quick-nav";let a=document.createElement("div");a.className="govuk-button-group";let n=this.createTodayButton();a.appendChild(n);let d=this.createNextAvailableButton();a.appendChild(d),e.appendChild(a);let f=this.createShortcutsHint();e.appendChild(f),t.parentNode.insertBefore(e,t)}createTodayButton(){let t=document.createElement("button");return t.type="button",t.className="govuk-button govuk-button--secondary dgwltd-calendar__today-btn",t.textContent="Jump to Today",t.setAttribute("title","Navigate to current month and highlight today"),t.addEventListener("click",e=>{e.preventDefault(),this.jumpToToday()}),t}createNextAvailableButton(){let t=document.createElement("button");return t.type="button",t.className="govuk-button govuk-button--secondary dgwltd-calendar__next-available-btn",t.textContent="Next Available",t.setAttribute("title","Find and navigate to next available date"),t.addEventListener("click",e=>{e.preventDefault(),this.findNextAvailableDate()}),t}createShortcutsHint(){let t=document.createElement("div");return t.className="dgwltd-calendar__shortcuts-hint",t.innerHTML="<small><strong>Shortcuts:</strong> T = Today, N = Next Available</small>",t}addKeyboardShortcuts(){document.addEventListener("keydown",t=>{if(this.form.contains(document.activeElement)&&!(t.target.tagName==="INPUT"&&t.target.type==="text"))switch(t.key.toLowerCase()){case"t":t.preventDefault(),this.jumpToToday();break;case"n":t.preventDefault(),this.findNextAvailableDate();break;case"arrowleft":t.preventDefault(),this.navigateToPreviousMonth();break;case"arrowright":t.preventDefault(),this.navigateToNextMonth();break}})}jumpToToday(){let t=this.getCurrentMonthFromUrl(),e=this.getCurrentYearFromUrl(),a=this.today.month()+1,n=this.today.year();t!==a||e!==n?this.navigateToMonth(n,a):this.highlightToday(),this.showNavigationFeedback(`Navigated to ${this.formatDate(this.today)}`)}findNextAvailableDate(){let t=this.findNextValidDate();if(t){let e=t.month()+1,a=t.year(),n=this.getCurrentMonthFromUrl(),d=this.getCurrentYearFromUrl();if(n!==e||d!==a){let f=x(t),g=this.addHighlightParam(this.buildNavigationUrl(a,e),f);window.location.href=g}else this.highlightDate(t),this.showNavigationFeedback(`Next available date: ${this.formatDate(t)}`)}else this.showNavigationFeedback("No available dates found in the next 365 days","error")}findNextValidDate(){let t=this.today.add(1,"day");for(let e=0;e<365;e++){let a=x(t);if(this.validator.validateDate(a).valid)return t;t=t.add(1,"day")}return null}highlightToday(){let t=x(this.today),e=this.form.querySelector(`input[value="${t}"]`);e&&this.highlightCheckbox(e,"today")}highlightDate(t){let e=x(t),a=this.form.querySelector(`input[value="${e}"]`);a&&(this.highlightCheckbox(a,"next-available"),a.scrollIntoView({behavior:"smooth",block:"center"}))}highlightCheckbox(t,e){let a=t.closest(".dgwltd-calendar__day");a.classList.remove("dgwltd-calendar__day--highlight");let n="dgwltd-calendar__day--highlight";a.classList.add(n),setTimeout(()=>{a.classList.remove(n)},3e3)}navigateToPreviousMonth(){let t=this.getCurrentMonthFromUrl(),e=this.getCurrentYearFromUrl(),a=t-1,n=e;a<1&&(a=12,n=e-1),this.navigateToMonth(n,a)}navigateToNextMonth(){let t=this.getCurrentMonthFromUrl(),e=this.getCurrentYearFromUrl(),a=t+1,n=e;a>12&&(a=1,n=e+1),this.navigateToMonth(n,a)}navigateToMonth(t,e){let a=this.buildNavigationUrl(t,e);window.location.href=a}buildNavigationUrl(t,e){let a=this.removeQueryParams(window.location.href,["cal_month","cal_year","highlight"]),n=a.includes("?")?"&":"?";return`${a}${n}cal_year=${t}&cal_month=${e}`}addHighlightParam(t,e){let a=t.includes("?")?"&":"?";return`${t}${a}highlight=${e}`}getCurrentMonthFromUrl(){let t=new URLSearchParams(window.location.search);return parseInt(t.get("cal_month"))||new Date().getMonth()+1}getCurrentYearFromUrl(){let t=new URLSearchParams(window.location.search);return parseInt(t.get("cal_year"))||new Date().getFullYear()}removeQueryParams(t,e){let a=new URL(t);return e.forEach(n=>{a.searchParams.delete(n)}),a.toString()}showNavigationFeedback(t,e="info"){let a=this.form.querySelector(".dgwltd-calendar__nav-feedback");a&&a.remove();let n=document.createElement("div");n.className=`dgwltd-calendar__nav-feedback dgwltd-calendar__nav-feedback--${e}`,n.setAttribute("role","status"),n.textContent=t;let d=this.form.querySelector("#calendar-hint");d&&d.appendChild(n),setTimeout(()=>{n.parentNode&&n.remove()},3e3)}formatDate(t){return new Intl.DateTimeFormat("en-GB",{weekday:"long",day:"numeric",month:"long",year:"numeric"}).format(t.toDate())}};function dt(i){let e=new URLSearchParams(window.location.search).get("highlight");if(e){let a=i.querySelector(`input[value="${e}"]`);if(a){let n=a.closest(".dgwltd-calendar__day");n.classList.add("dgwltd-calendar__day--highlight"),a.scrollIntoView({behavior:"smooth",block:"center"}),setTimeout(()=>{n.classList.remove("dgwltd-calendar__day--highlight")},5e3)}}}var _t={unavailable_dates:["2025-09-16","2025-09-20","2025-09-25","2025-12-25","2025-01-01"]},z=class{constructor(t,e){this.form=t,this.validator=e,this.apiEndpoint=this.form.dataset.apiEndpoint}async init(){try{let t=await this.fetchUnavailableDates();this.applyBlackoutDates(t.unavailable_dates||[])}catch(t){console.warn("Calendar API failed, using fallback:",t)}}async fetchUnavailableDates(){return Promise.resolve(_t)}applyBlackoutDates(t){if(!t||t.length===0)return;let e=this.form.dataset.blackoutDates||"",a=e?e.split(",").map(f=>f.trim()):[],n=[...new Set([...a,...t])];this.form.dataset.blackoutDates=n.join(","),this.form.dataset.validation||(this.form.dataset.validation="blackout");let d=this.form.querySelectorAll('input[name="selected_dates[]"]');W(this.validator,d),console.log("\u2705 Applied blackout dates from API:",n)}};var et=class{constructor(t){this.form=t,this.submitButton=this.form.querySelector('button[type="submit"]:not([name="clear_selection"])'),this.timeSelect=this.form.querySelector("#cal_time"),this.singleDateInputs={day:this.form.querySelector("#calendar-single-day"),month:this.form.querySelector("#calendar-single-month"),year:this.form.querySelector("#calendar-single-year")},this.init()}init(){this.form.dataset.required==="time"&&this.timeSelect&&this.submitButton&&this.initTimeValidation(),this.singleDateInputs.day&&this.singleDateInputs.month&&this.singleDateInputs.year&&this.initSingleDateValidation(),this.form.addEventListener("submit",t=>this.handleSubmit(t))}initTimeValidation(){let t=()=>{let e=this.timeSelect.value.trim()!=="";this.submitButton.disabled=!e,e?this.submitButton.removeAttribute("title"):this.submitButton.setAttribute("title","Please select a time before continuing")};t(),this.timeSelect.addEventListener("change",t)}initSingleDateValidation(){Object.values(this.singleDateInputs).forEach(t=>{t.addEventListener("blur",()=>{this.hasCompleteDate()?this.validateSingleDate():(this.clearSingleDateErrors(),this.updateErrorDisplay())}),t.addEventListener("input",()=>{t.classList.contains("govuk-input--error")&&(this.clearSingleDateErrors(),this.updateErrorDisplay())})})}hasCompleteDate(){let t=this.singleDateInputs.day.value.trim(),e=this.singleDateInputs.month.value.trim(),a=this.singleDateInputs.year.value.trim();return t!==""&&e!==""&&a!==""}validateSingleDate(){if(!this.hasCompleteDate())return this.clearSingleDateErrors(),this.updateErrorDisplay(),{valid:!0,errors:[]};let t=this.singleDateInputs.day.value.trim(),e=this.singleDateInputs.month.value.trim(),a=this.singleDateInputs.year.value.trim(),n=[],d=[];if((isNaN(parseInt(t))||parseInt(t)<1||parseInt(t)>31)&&(n.push("Enter a valid day"),d.push("day")),(isNaN(parseInt(e))||parseInt(e)<1||parseInt(e)>12)&&(n.push("Enter a valid month"),d.push("month")),(isNaN(parseInt(a))||parseInt(a)<1900||parseInt(a)>2100)&&(n.push("Enter a valid year"),d.push("year")),n.length===0){let f=`${a}-${e.padStart(2,"0")}-${t.padStart(2,"0")}`,g=w(f);if(!g||!g.isValid())n.push("Enter a real date"),d.push("day","month","year");else{let k=w();g.isBefore(k,"day")&&(n.push("Enter a date in the future"),d.push("day","month","year"))}}return this.clearSingleDateErrors(),d.forEach(f=>{this.singleDateInputs[f]&&this.singleDateInputs[f].classList.add("govuk-input--error")}),this.updateErrorDisplay(n),{valid:n.length===0,errors:n}}clearSingleDateErrors(){Object.values(this.singleDateInputs).forEach(t=>{t.classList.remove("govuk-input--error")})}updateErrorDisplay(t=[]){let e=this.form.querySelector(".govuk-error-summary"),a=this.form.querySelector(".govuk-error-summary__list");if(!e||!a)return;if(t.length===0){e.setAttribute("hidden",""),a.innerHTML="";return}let n=t.map(d=>`<li><a href="#calendar-single">${d}</a></li>`).join("");a.innerHTML=n,e.removeAttribute("hidden"),e.focus()}handleSubmit(t){let e=!1;if(this.hasCompleteDate()&&!this.validateSingleDate().valid){e=!0;let n=Object.values(this.singleDateInputs).find(d=>d.classList.contains("govuk-input--error"));n&&n.focus()}e&&t.preventDefault()}};function ct(){let i=document.querySelector(".dgwltd-calendar__form");i&&(new et(i),console.log("\u2705 Calendar Form Validation initialized"))}document.addEventListener("DOMContentLoaded",function(){let i=document.querySelector(".dgwltd-calendar__form");if(!i)return;let t=new H(i),e=i.querySelectorAll('input[name="selected_dates[]"]');e.forEach(p=>{let R=t.validateDate(p.value);R.valid?tt(p):X(p,R.reason)});let a=i.dataset.rangeSelection==="true",n=null;a&&(n=new j(i,t),lt(i));let d=i.dataset.navigation==="true",f=null;d&&(f=new V(i,t)),dt(i),ct();let g=i.dataset.apiEnabled==="true",k=null;g&&(k=new z(i,t),k.init()),i.addEventListener("change",function(){t.needsRevalidation()&&W(t,e)}),console.log("\u2705 Enhanced Calendar System initialized:",{validation:t.validationType,rangeSelection:a,navigation:d,apiIntegration:g,totalDates:e.length,validDates:Array.from(e).filter(p=>!p.disabled).length})});})();
