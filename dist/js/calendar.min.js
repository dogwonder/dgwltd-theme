(()=>{var Ct=Object.create;var vt=Object.defineProperty;var Rt=Object.getOwnPropertyDescriptor;var Nt=Object.getOwnPropertyNames;var Yt=Object.getPrototypeOf,At=Object.prototype.hasOwnProperty;var Z=(n,t)=>()=>(t||n((t={exports:{}}).exports,t),t.exports);var Lt=(n,t,e,a)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of Nt(t))!At.call(n,r)&&r!==e&&vt(n,r,{get:()=>t[r],enumerable:!(a=Rt(t,r))||a.enumerable});return n};var J=(n,t,e)=>(e=n!=null?Ct(Yt(n)):{},Lt(t||!n||!n.__esModule?vt(e,"default",{value:n,enumerable:!0}):e,n));var yt=Z((et,at)=>{(function(n,t){typeof et=="object"&&typeof at<"u"?at.exports=t():typeof define=="function"&&define.amd?define(t):(n=typeof globalThis<"u"?globalThis:n||self).dayjs=t()})(et,(function(){"use strict";var n=1e3,t=6e4,e=36e5,a="millisecond",r="second",f="minute",u="hour",m="day",k="week",S="month",$="quarter",w="year",v="date",d="Invalid Date",p=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,O=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,T={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(c){var o=["th","st","nd","rd"],i=c%100;return"["+c+(o[(i-20)%10]||o[i]||o[0])+"]"}},_=function(c,o,i){var l=String(c);return!l||l.length>=o?c:""+Array(o+1-l.length).join(i)+c},A={s:_,z:function(c){var o=-c.utcOffset(),i=Math.abs(o),l=Math.floor(i/60),s=i%60;return(o<=0?"+":"-")+_(l,2,"0")+":"+_(s,2,"0")},m:function c(o,i){if(o.date()<i.date())return-c(i,o);var l=12*(i.year()-o.year())+(i.month()-o.month()),s=o.clone().add(l,S),h=i-s<0,g=o.clone().add(l+(h?-1:1),S);return+(-(l+(i-s)/(h?s-g:g-s))||0)},a:function(c){return c<0?Math.ceil(c)||0:Math.floor(c)},p:function(c){return{M:S,y:w,w:k,d:m,D:v,h:u,m:f,s:r,ms:a,Q:$}[c]||String(c||"").toLowerCase().replace(/s$/,"")},u:function(c){return c===void 0}},x="en",N={};N[x]=T;var E="$isDayjsObject",F=function(c){return c instanceof Q||!(!c||!c[E])},I=function c(o,i,l){var s;if(!o)return x;if(typeof o=="string"){var h=o.toLowerCase();N[h]&&(s=h),i&&(N[h]=i,s=h);var g=o.split("-");if(!s&&g.length>1)return c(g[0])}else{var D=o.name;N[D]=o,s=D}return!l&&s&&(x=s),s||!l&&x},b=function(c,o){if(F(c))return c.clone();var i=typeof o=="object"?o:{};return i.date=c,i.args=arguments,new Q(i)},y=A;y.l=I,y.i=F,y.w=function(c,o){return b(c,{locale:o.$L,utc:o.$u,x:o.$x,$offset:o.$offset})};var Q=(function(){function c(i){this.$L=I(i.locale,null,!0),this.parse(i),this.$x=this.$x||i.x||{},this[E]=!0}var o=c.prototype;return o.parse=function(i){this.$d=(function(l){var s=l.date,h=l.utc;if(s===null)return new Date(NaN);if(y.u(s))return new Date;if(s instanceof Date)return new Date(s);if(typeof s=="string"&&!/Z$/i.test(s)){var g=s.match(p);if(g){var D=g[2]-1||0,M=(g[7]||"0").substring(0,3);return h?new Date(Date.UTC(g[1],D,g[3]||1,g[4]||0,g[5]||0,g[6]||0,M)):new Date(g[1],D,g[3]||1,g[4]||0,g[5]||0,g[6]||0,M)}}return new Date(s)})(i),this.init()},o.init=function(){var i=this.$d;this.$y=i.getFullYear(),this.$M=i.getMonth(),this.$D=i.getDate(),this.$W=i.getDay(),this.$H=i.getHours(),this.$m=i.getMinutes(),this.$s=i.getSeconds(),this.$ms=i.getMilliseconds()},o.$utils=function(){return y},o.isValid=function(){return this.$d.toString()!==d},o.isSame=function(i,l){var s=b(i);return this.startOf(l)<=s&&s<=this.endOf(l)},o.isAfter=function(i,l){return b(i)<this.startOf(l)},o.isBefore=function(i,l){return this.endOf(l)<b(i)},o.$g=function(i,l,s){return y.u(i)?this[l]:this.set(s,i)},o.unix=function(){return Math.floor(this.valueOf()/1e3)},o.valueOf=function(){return this.$d.getTime()},o.startOf=function(i,l){var s=this,h=!!y.u(l)||l,g=y.p(i),D=function(z,L){var B=y.w(s.$u?Date.UTC(s.$y,L,z):new Date(s.$y,L,z),s);return h?B:B.endOf(m)},M=function(z,L){return y.w(s.toDate()[z].apply(s.toDate("s"),(h?[0,0,0,0]:[23,59,59,999]).slice(L)),s)},C=this.$W,R=this.$M,U=this.$D,W="set"+(this.$u?"UTC":"");switch(g){case w:return h?D(1,0):D(31,11);case S:return h?D(1,R):D(0,R+1);case k:var q=this.$locale().weekStart||0,j=(C<q?C+7:C)-q;return D(h?U-j:U+(6-j),R);case m:case v:return M(W+"Hours",0);case u:return M(W+"Minutes",1);case f:return M(W+"Seconds",2);case r:return M(W+"Milliseconds",3);default:return this.clone()}},o.endOf=function(i){return this.startOf(i,!1)},o.$set=function(i,l){var s,h=y.p(i),g="set"+(this.$u?"UTC":""),D=(s={},s[m]=g+"Date",s[v]=g+"Date",s[S]=g+"Month",s[w]=g+"FullYear",s[u]=g+"Hours",s[f]=g+"Minutes",s[r]=g+"Seconds",s[a]=g+"Milliseconds",s)[h],M=h===m?this.$D+(l-this.$W):l;if(h===S||h===w){var C=this.clone().set(v,1);C.$d[D](M),C.init(),this.$d=C.set(v,Math.min(this.$D,C.daysInMonth())).$d}else D&&this.$d[D](M);return this.init(),this},o.set=function(i,l){return this.clone().$set(i,l)},o.get=function(i){return this[y.p(i)]()},o.add=function(i,l){var s,h=this;i=Number(i);var g=y.p(l),D=function(R){var U=b(h);return y.w(U.date(U.date()+Math.round(R*i)),h)};if(g===S)return this.set(S,this.$M+i);if(g===w)return this.set(w,this.$y+i);if(g===m)return D(1);if(g===k)return D(7);var M=(s={},s[f]=t,s[u]=e,s[r]=n,s)[g]||1,C=this.$d.getTime()+i*M;return y.w(C,this)},o.subtract=function(i,l){return this.add(-1*i,l)},o.format=function(i){var l=this,s=this.$locale();if(!this.isValid())return s.invalidDate||d;var h=i||"YYYY-MM-DDTHH:mm:ssZ",g=y.z(this),D=this.$H,M=this.$m,C=this.$M,R=s.weekdays,U=s.months,W=s.meridiem,q=function(L,B,V,G){return L&&(L[B]||L(l,h))||V[B].slice(0,G)},j=function(L){return y.s(D%12||12,L,"0")},z=W||function(L,B,V){var G=L<12?"AM":"PM";return V?G.toLowerCase():G};return h.replace(O,(function(L,B){return B||(function(V){switch(V){case"YY":return String(l.$y).slice(-2);case"YYYY":return y.s(l.$y,4,"0");case"M":return C+1;case"MM":return y.s(C+1,2,"0");case"MMM":return q(s.monthsShort,C,U,3);case"MMMM":return q(U,C);case"D":return l.$D;case"DD":return y.s(l.$D,2,"0");case"d":return String(l.$W);case"dd":return q(s.weekdaysMin,l.$W,R,2);case"ddd":return q(s.weekdaysShort,l.$W,R,3);case"dddd":return R[l.$W];case"H":return String(D);case"HH":return y.s(D,2,"0");case"h":return j(1);case"hh":return j(2);case"a":return z(D,M,!0);case"A":return z(D,M,!1);case"m":return String(M);case"mm":return y.s(M,2,"0");case"s":return String(l.$s);case"ss":return y.s(l.$s,2,"0");case"SSS":return y.s(l.$ms,3,"0");case"Z":return g}return null})(L)||g.replace(":","")}))},o.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},o.diff=function(i,l,s){var h,g=this,D=y.p(l),M=b(i),C=(M.utcOffset()-this.utcOffset())*t,R=this-M,U=function(){return y.m(g,M)};switch(D){case w:h=U()/12;break;case S:h=U();break;case $:h=U()/3;break;case k:h=(R-C)/6048e5;break;case m:h=(R-C)/864e5;break;case u:h=R/e;break;case f:h=R/t;break;case r:h=R/n;break;default:h=R}return s?h:y.a(h)},o.daysInMonth=function(){return this.endOf(S).$D},o.$locale=function(){return N[this.$L]},o.locale=function(i,l){if(!i)return this.$L;var s=this.clone(),h=I(i,l,!0);return h&&(s.$L=h),s},o.clone=function(){return y.w(this.$d,this)},o.toDate=function(){return new Date(this.valueOf())},o.toJSON=function(){return this.isValid()?this.toISOString():null},o.toISOString=function(){return this.$d.toISOString()},o.toString=function(){return this.$d.toUTCString()},c})(),mt=Q.prototype;return b.prototype=mt,[["$ms",a],["$s",r],["$m",f],["$H",u],["$W",m],["$M",S],["$y",w],["$D",v]].forEach((function(c){mt[c[1]]=function(o){return this.$g(o,c[0],c[1])}})),b.extend=function(c,o){return c.$i||(c(o,Q,b),c.$i=!0),b},b.locale=I,b.isDayjs=F,b.unix=function(c){return b(1e3*c)},b.en=N[x],b.Ls=N,b.p={},b}))});var pt=Z((nt,rt)=>{(function(n,t){typeof nt=="object"&&typeof rt<"u"?rt.exports=t():typeof define=="function"&&define.amd?define(t):(n=typeof globalThis<"u"?globalThis:n||self).dayjs_plugin_utc=t()})(nt,(function(){"use strict";var n="minute",t=/[+-]\d\d(?::?\d\d)?/g,e=/([+-]|\d\d)/g;return function(a,r,f){var u=r.prototype;f.utc=function(d){var p={date:d,utc:!0,args:arguments};return new r(p)},u.utc=function(d){var p=f(this.toDate(),{locale:this.$L,utc:!0});return d?p.add(this.utcOffset(),n):p},u.local=function(){return f(this.toDate(),{locale:this.$L,utc:!1})};var m=u.parse;u.parse=function(d){d.utc&&(this.$u=!0),this.$utils().u(d.$offset)||(this.$offset=d.$offset),m.call(this,d)};var k=u.init;u.init=function(){if(this.$u){var d=this.$d;this.$y=d.getUTCFullYear(),this.$M=d.getUTCMonth(),this.$D=d.getUTCDate(),this.$W=d.getUTCDay(),this.$H=d.getUTCHours(),this.$m=d.getUTCMinutes(),this.$s=d.getUTCSeconds(),this.$ms=d.getUTCMilliseconds()}else k.call(this)};var S=u.utcOffset;u.utcOffset=function(d,p){var O=this.$utils().u;if(O(d))return this.$u?0:O(this.$offset)?S.call(this):this.$offset;if(typeof d=="string"&&(d=(function(x){x===void 0&&(x="");var N=x.match(t);if(!N)return null;var E=(""+N[0]).match(e)||["-",0,0],F=E[0],I=60*+E[1]+ +E[2];return I===0?0:F==="+"?I:-I})(d),d===null))return this;var T=Math.abs(d)<=16?60*d:d;if(T===0)return this.utc(p);var _=this.clone();if(p)return _.$offset=T,_.$u=!1,_;var A=this.$u?this.toDate().getTimezoneOffset():-1*this.utcOffset();return(_=this.local().add(T+A,n)).$offset=T,_.$x.$localOffset=A,_};var $=u.format;u.format=function(d){var p=d||(this.$u?"YYYY-MM-DDTHH:mm:ss[Z]":"");return $.call(this,p)},u.valueOf=function(){var d=this.$utils().u(this.$offset)?0:this.$offset+(this.$x.$localOffset||this.$d.getTimezoneOffset());return this.$d.valueOf()-6e4*d},u.isUTC=function(){return!!this.$u},u.toISOString=function(){return this.toDate().toISOString()},u.toString=function(){return this.toDate().toUTCString()};var w=u.toDate;u.toDate=function(d){return d==="s"&&this.$offset?f(this.format("YYYY-MM-DD HH:mm:ss:SSS")).toDate():w.call(this)};var v=u.diff;u.diff=function(d,p,O){if(d&&this.$u===d.$u)return v.call(this,d,p,O);var T=this.local(),_=f(d).local();return v.call(T,_,p,O)}}}))});var Dt=Z((it,st)=>{(function(n,t){typeof it=="object"&&typeof st<"u"?st.exports=t():typeof define=="function"&&define.amd?define(t):(n=typeof globalThis<"u"?globalThis:n||self).dayjs_plugin_timezone=t()})(it,(function(){"use strict";var n={year:0,month:1,day:2,hour:3,minute:4,second:5},t={};return function(e,a,r){var f,u=function($,w,v){v===void 0&&(v={});var d=new Date($),p=(function(O,T){T===void 0&&(T={});var _=T.timeZoneName||"short",A=O+"|"+_,x=t[A];return x||(x=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:O,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",timeZoneName:_}),t[A]=x),x})(w,v);return p.formatToParts(d)},m=function($,w){for(var v=u($,w),d=[],p=0;p<v.length;p+=1){var O=v[p],T=O.type,_=O.value,A=n[T];A>=0&&(d[A]=parseInt(_,10))}var x=d[3],N=x===24?0:x,E=d[0]+"-"+d[1]+"-"+d[2]+" "+N+":"+d[4]+":"+d[5]+":000",F=+$;return(r.utc(E).valueOf()-(F-=F%1e3))/6e4},k=a.prototype;k.tz=function($,w){$===void 0&&($=f);var v,d=this.utcOffset(),p=this.toDate(),O=p.toLocaleString("en-US",{timeZone:$}),T=Math.round((p-new Date(O))/1e3/60),_=15*-Math.round(p.getTimezoneOffset()/15)-T;if(!Number(_))v=this.utcOffset(0,w);else if(v=r(O,{locale:this.$L}).$set("millisecond",this.$ms).utcOffset(_,!0),w){var A=v.utcOffset();v=v.add(d-A,"minute")}return v.$x.$timezone=$,v},k.offsetName=function($){var w=this.$x.$timezone||r.tz.guess(),v=u(this.valueOf(),w,{timeZoneName:$}).find((function(d){return d.type.toLowerCase()==="timezonename"}));return v&&v.value};var S=k.startOf;k.startOf=function($,w){if(!this.$x||!this.$x.$timezone)return S.call(this,$,w);var v=r(this.format("YYYY-MM-DD HH:mm:ss:SSS"),{locale:this.$L});return S.call(v,$,w).tz(this.$x.$timezone,!0)},r.tz=function($,w,v){var d=v&&w,p=v||w||f,O=m(+r(),p);if(typeof $!="string")return r($).tz(p);var T=(function(N,E,F){var I=N-60*E*1e3,b=m(I,F);if(E===b)return[I,E];var y=m(I-=60*(b-E)*1e3,F);return b===y?[I,b]:[N-60*Math.min(b,y)*1e3,Math.max(b,y)]})(r.utc($,d).valueOf(),O,p),_=T[0],A=T[1],x=r(_).utcOffset(A);return x.$x.$timezone=p,x},r.tz.guess=function(){return Intl.DateTimeFormat().resolvedOptions().timeZone},r.tz.setDefault=function($){f=$}}}))});var $t=Z((ot,dt)=>{(function(n,t){typeof ot=="object"&&typeof dt<"u"?dt.exports=t():typeof define=="function"&&define.amd?define(t):(n=typeof globalThis<"u"?globalThis:n||self).dayjs_plugin_isSameOrBefore=t()})(ot,(function(){"use strict";return function(n,t){t.prototype.isSameOrBefore=function(e,a){return this.isSame(e,a)||this.isBefore(e,a)}}}))});var wt=Z((lt,ut)=>{(function(n,t){typeof lt=="object"&&typeof ut<"u"?ut.exports=t():typeof define=="function"&&define.amd?define(t):(n=typeof globalThis<"u"?globalThis:n||self).dayjs_plugin_isSameOrAfter=t()})(lt,(function(){"use strict";return function(n,t){t.prototype.isSameOrAfter=function(e,a){return this.isSame(e,a)||this.isAfter(e,a)}}}))});var P=J(yt(),1),bt=J(pt(),1),St=J(Dt(),1),_t=J($t(),1),Mt=J(wt(),1);P.default.extend(bt.default);P.default.extend(St.default);P.default.extend(_t.default);P.default.extend(Mt.default);function Y(n){if(!n)return null;if(P.default.isDayjs(n))return n.startOf("day");let t=(0,P.default)(n);return t.isValid()?t.startOf("day"):(console.warn("Invalid date input:",n),null)}function H(n){let t=Y(n);return t?t.format("YYYY-MM-DD"):""}function kt(){return(0,P.default)().startOf("day")}function ct(n,t){let e=Y(n),a=Y(t);if(!e||!a||!e.isValid()||!a.isValid())return console.warn("Invalid date range:",n,t),[];let[r,f]=e.isAfter(a)?[a,e]:[e,a],u=[],m=r;for(;m.isSameOrBefore(f);)u.push(m.format("YYYY-MM-DD")),m=m.add(1,"day");return u}function ft(n,t){let e=H(n);return t.includes(e)}var K=class{constructor(t){this.form=t,this.validationType=this.form.dataset.validation||"none",this.today=Y(new Date)}validateDate(t){try{let e=Y(t);if(!e)return{valid:!1,reason:"Invalid date format"};switch(this.validationType){case"future":return this.validateFuture(e);case"past":return this.validatePast(e);case"range":return this.validateRange(e);case"year":return this.validateYear(e);case"custom":return this.validateCustomRange(e);case"weekdays":return this.validateWeekdays(e);case"weekends":return this.validateWeekends(e);case"days":return this.validateSpecificDays(e);case"blackout":return this.validateBlackout(e);case"advance-notice":return this.validateAdvanceNotice(e);case"booking-window":return this.validateBookingWindow(e);case"business":return this.validateBusinessRules(e);case"none":default:return{valid:!0,reason:""}}}catch{return{valid:!1,reason:"Date parsing error"}}}validateFuture(t){return t.isSameOrAfter(this.today)?{valid:!0,reason:""}:{valid:!1,reason:"Only future dates are allowed"}}validatePast(t){return t.isSameOrBefore(this.today)?{valid:!0,reason:""}:{valid:!1,reason:"Only past dates are allowed"}}validateRange(t){let e=this.form.dataset.rangeStart?Y(this.form.dataset.rangeStart):null,a=this.form.dataset.rangeEnd?Y(this.form.dataset.rangeEnd):null;return!e&&!a?{valid:!1,reason:"Range validation requires start or end date"}:e&&t.isBefore(e)?{valid:!1,reason:`Date must be after ${this.formatDate(e)}`}:a&&t.isAfter(a)?{valid:!1,reason:`Date must be before ${this.formatDate(a)}`}:{valid:!0,reason:""}}validateYear(t){let e=parseInt(this.form.dataset.year);return e?t.year()===e?{valid:!0,reason:""}:{valid:!1,reason:`Only dates in ${e} are allowed`}:{valid:!1,reason:"Year validation requires data-year attribute"}}validateCustomRange(t){let e=this.form.dataset.minDate?Y(this.form.dataset.minDate):null,a=this.form.dataset.maxDate?Y(this.form.dataset.maxDate):null;return e&&t.isBefore(e)?{valid:!1,reason:`Date must be after ${this.formatDate(e)}`}:a&&t.isAfter(a)?{valid:!1,reason:`Date must be before ${this.formatDate(a)}`}:{valid:!0,reason:""}}validateWeekdays(t){let e=t.day();return e>=1&&e<=5?{valid:!0,reason:""}:{valid:!1,reason:"Only weekdays are allowed"}}validateWeekends(t){let e=t.day();return e===0||e===6?{valid:!0,reason:""}:{valid:!1,reason:"Only weekends are allowed"}}validateSpecificDays(t){let e=this.form.dataset.allowedDays?.split(",").map(u=>parseInt(u.trim()));if(!e||e.length===0)return{valid:!1,reason:"No allowed days specified"};let a=t.day();if(e.includes(a))return{valid:!0,reason:""};let r=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];return{valid:!1,reason:`Only ${e.map(u=>r[u]).join(", ")} are allowed`}}validateBlackout(t){let e=this.form.dataset.blackoutDates?.split(",").map(f=>f.trim())||[],a=this.form.dataset.blackoutRanges?.split(",").map(f=>f.trim())||[],r=H(t);if(e.includes(r))return{valid:!1,reason:"Date is not available"};for(let f of a){let[u,m]=f.split(":");if(u&&m){let k=Y(u),S=Y(m);if(t.isSameOrAfter(k)&&t.isSameOrBefore(S))return{valid:!1,reason:"Date is in blackout period"}}}return{valid:!0,reason:""}}validateAdvanceNotice(t){let e=parseInt(this.form.dataset.minAdvanceDays)||0,a=this.today.add(e,"day");return t.isSameOrAfter(a)?{valid:!0,reason:""}:{valid:!1,reason:`Requires ${e} days advance notice`}}validateBookingWindow(t){let e=parseInt(this.form.dataset.maxAdvanceDays)||365,a=this.today.add(e,"day");return t.isSameOrBefore(a)?{valid:!0,reason:""}:{valid:!1,reason:`Cannot book more than ${e} days in advance`}}validateBusinessRules(t){let e=this.validateAdvanceNotice(t);if(!e.valid)return e;let a=this.validateBookingWindow(t);if(!a.valid)return a;let r=this.validateSpecificDays(t);return r.valid?{valid:!0,reason:""}:r}needsRevalidation(){return this.form.dataset.maxSelections||this.validationType==="consecutive"}formatDate(t){return new Intl.DateTimeFormat("en-GB",{day:"numeric",month:"long",year:"numeric"}).format(t.toDate())}};function ht(n,t){let e=n.closest(".dgwltd-calendar__day"),a=e.querySelector(".govuk-checkboxes__label");n.disabled=!0,n.setAttribute("aria-describedby",n.id+"-disabled-reason"),e.classList.add("dgwltd-calendar__day--disabled");let r=e.querySelector(".dgwltd-calendar__disabled-reason");r||(r=document.createElement("span"),r.className="dgwltd-calendar__disabled-reason govuk-visually-hidden",r.id=n.id+"-disabled-reason",e.appendChild(r)),r.textContent=t,a.setAttribute("title",t)}function gt(n){let t=n.closest(".dgwltd-calendar__day"),e=t.querySelector(".govuk-checkboxes__label"),a=t.querySelector(".dgwltd-calendar__disabled-reason");n.disabled=!1,n.removeAttribute("aria-describedby"),t.classList.remove("dgwltd-calendar__day--disabled"),a&&a.remove(),e.removeAttribute("title")}function xt(n,t){t.forEach(e=>{let a=n.validateDate(e.value);a.valid?gt(e):ht(e,a.reason)})}var X=class{constructor(t,e){this.form=t,this.validator=e,this.lastSelectedDate=null,this.isRangeMode=!1,this.previewRange=[],this.init()}init(){this.form.querySelectorAll('input[name="selected_dates[]"]').forEach(e=>{e.addEventListener("click",a=>this.handleDateClick(a,e)),e.addEventListener("mouseenter",a=>this.handleDateHover(a,e)),e.addEventListener("mouseleave",()=>this.clearRangePreview())}),document.addEventListener("click",e=>{this.form.contains(e.target)||this.exitRangeMode()})}handleDateClick(t,e){if(e.disabled)return t.preventDefault(),!1;let a=Y(e.value);if(this.isRangeMode&&this.lastSelectedDate)return t.preventDefault(),e.checked=!0,this.selectDateRange(this.lastSelectedDate,a,e),this.exitRangeMode(),!1;e.checked?(this.lastSelectedDate=a,this.isRangeMode=!0,this.showRangeStartFeedback(e)):this.exitRangeMode()}handleDateHover(t,e){if(!this.isRangeMode||!this.lastSelectedDate||e.disabled)return;let a=Y(e.value);this.showRangePreview(this.lastSelectedDate,a)}selectDateRange(t,e){t>e&&([t,e]=[e,t]);let a=ct(t,e);console.log("Range selection debug:",{startDate:H(t),endDate:H(e),datesInRange:a});let r=this.form.querySelectorAll('input[name="selected_dates[]"]'),f=0;r.forEach(u=>{let m=u.value,k=ft(m,a),S=u.disabled;console.log("Checkbox check:",{value:m,inRange:k,disabled:S,willSelect:k&&!S}),k&&!S&&(u.checked=!0,u.dispatchEvent(new Event("change",{bubbles:!0})),f++,console.log("\u2705 Selected checkbox:",m))}),console.log(`Total selected: ${f} out of ${a.length} dates in range`),this.clearRangePreview()}showRangePreview(t,e){this.clearRangePreview(),t>e&&([t,e]=[e,t]);let a=ct(t,e);this.form.querySelectorAll('input[name="selected_dates[]"]').forEach(f=>{let u=f.value;ft(u,a)&&!f.disabled&&f.closest(".dgwltd-calendar__day").classList.add("dgwltd-calendar__day--preview-range")}),this.previewRange=a}clearRangePreview(){this.form.querySelectorAll(".dgwltd-calendar__day--preview-range").forEach(e=>{e.classList.remove("dgwltd-calendar__day--preview-range")}),this.previewRange=[]}showRangeStartFeedback(t){t.closest(".dgwltd-calendar__day").classList.add("dgwltd-calendar__day--range-start"),this.showRangeInstruction()}showRangeInstruction(){let t=this.form.querySelector(".dgwltd-calendar__range-instruction");t&&t.remove();let e=document.createElement("div");e.className="dgwltd-calendar__range-instruction",e.setAttribute("role","status"),e.textContent="Range start selected. Click another date to complete the range.";let a=this.form.querySelector("#calendar-hint");a&&a.appendChild(e)}exitRangeMode(){this.isRangeMode=!1,this.lastSelectedDate=null,this.clearRangePreview(),this.clearRangeStartFeedback(),this.clearRangeInstruction()}clearRangeStartFeedback(){this.form.querySelectorAll(".dgwltd-calendar__day--range-start").forEach(e=>{e.classList.remove("dgwltd-calendar__day--range-start")})}clearRangeInstruction(){let t=this.form.querySelector(".dgwltd-calendar__range-instruction");t&&t.remove()}};function Tt(n){let t=n.querySelector("#calendar-hint");if(t){let e=document.createElement("div");e.className="dgwltd-calendar__range-hint",e.innerHTML='<div class="govuk-phase-banner"><p class="govuk-phase-banner__content"><strong class="govuk-tag govuk-phase-banner__content__tag">Tip</strong> <span class="govuk-phase-banner__text">Click two dates to select a date range</span></p></div>',t.appendChild(e)}}var tt=class{constructor(t,e){this.form=t,this.validator=e,this.today=kt(),this.init()}init(){this.addNavigationControls(),this.addKeyboardShortcuts()}addNavigationControls(){let t=this.form.querySelector(".govuk-pagination");if(!t)return;let e=document.createElement("div");e.className="dgwltd-calendar__quick-nav";let a=this.createTodayButton();e.appendChild(a);let r=this.createNextAvailableButton();e.appendChild(r);let f=this.createShortcutsHint();e.appendChild(f),t.parentNode.insertBefore(e,t)}createTodayButton(){let t=document.createElement("button");return t.type="button",t.className="govuk-button govuk-button--secondary dgwltd-calendar__today-btn",t.textContent="Jump to Today",t.setAttribute("title","Navigate to current month and highlight today"),t.addEventListener("click",e=>{e.preventDefault(),this.jumpToToday()}),t}createNextAvailableButton(){let t=document.createElement("button");return t.type="button",t.className="govuk-button govuk-button--secondary dgwltd-calendar__next-available-btn",t.textContent="Next Available",t.setAttribute("title","Find and navigate to next available date"),t.addEventListener("click",e=>{e.preventDefault(),this.findNextAvailableDate()}),t}createShortcutsHint(){let t=document.createElement("div");return t.className="dgwltd-calendar__shortcuts-hint",t.innerHTML="<small><strong>Shortcuts:</strong> T = Today, N = Next Available</small>",t}addKeyboardShortcuts(){document.addEventListener("keydown",t=>{if(this.form.contains(document.activeElement)&&!(t.target.tagName==="INPUT"&&t.target.type==="text"))switch(t.key.toLowerCase()){case"t":t.preventDefault(),this.jumpToToday();break;case"n":t.preventDefault(),this.findNextAvailableDate();break;case"arrowleft":t.preventDefault(),this.navigateToPreviousMonth();break;case"arrowright":t.preventDefault(),this.navigateToNextMonth();break}})}jumpToToday(){let t=this.getCurrentMonthFromUrl(),e=this.getCurrentYearFromUrl(),a=this.today.month()+1,r=this.today.year();t!==a||e!==r?this.navigateToMonth(r,a):this.highlightToday(),this.showNavigationFeedback(`Navigated to ${this.formatDate(this.today)}`)}findNextAvailableDate(){let t=this.findNextValidDate();if(t){let e=t.month()+1,a=t.year(),r=this.getCurrentMonthFromUrl(),f=this.getCurrentYearFromUrl();if(r!==e||f!==a){let u=H(t),m=this.addHighlightParam(this.buildNavigationUrl(a,e),u);window.location.href=m}else this.highlightDate(t),this.showNavigationFeedback(`Next available date: ${this.formatDate(t)}`)}else this.showNavigationFeedback("No available dates found in the next 365 days","error")}findNextValidDate(){let t=this.today.add(1,"day");for(let e=0;e<365;e++){let a=H(t);if(this.validator.validateDate(a).valid)return t;t=t.add(1,"day")}return null}highlightToday(){let t=H(this.today),e=this.form.querySelector(`input[value="${t}"]`);e&&this.highlightCheckbox(e,"today")}highlightDate(t){let e=H(t),a=this.form.querySelector(`input[value="${e}"]`);a&&(this.highlightCheckbox(a,"next-available"),a.scrollIntoView({behavior:"smooth",block:"center"}))}highlightCheckbox(t,e){let a=t.closest(".dgwltd-calendar__day");a.classList.remove("dgwltd-calendar__day--highlight-today","dgwltd-calendar__day--highlight-next");let r=e==="today"?"dgwltd-calendar__day--highlight-today":"dgwltd-calendar__day--highlight-next";a.classList.add(r),setTimeout(()=>{a.classList.remove(r)},3e3)}navigateToPreviousMonth(){let t=this.getCurrentMonthFromUrl(),e=this.getCurrentYearFromUrl(),a=t-1,r=e;a<1&&(a=12,r=e-1),this.navigateToMonth(r,a)}navigateToNextMonth(){let t=this.getCurrentMonthFromUrl(),e=this.getCurrentYearFromUrl(),a=t+1,r=e;a>12&&(a=1,r=e+1),this.navigateToMonth(r,a)}navigateToMonth(t,e){let a=this.buildNavigationUrl(t,e);window.location.href=a}buildNavigationUrl(t,e){let a=this.removeQueryParams(window.location.href,["cal_month","cal_year","highlight"]),r=a.includes("?")?"&":"?";return`${a}${r}cal_year=${t}&cal_month=${e}`}addHighlightParam(t,e){let a=t.includes("?")?"&":"?";return`${t}${a}highlight=${e}`}getCurrentMonthFromUrl(){let t=new URLSearchParams(window.location.search);return parseInt(t.get("cal_month"))||new Date().getMonth()+1}getCurrentYearFromUrl(){let t=new URLSearchParams(window.location.search);return parseInt(t.get("cal_year"))||new Date().getFullYear()}removeQueryParams(t,e){let a=new URL(t);return e.forEach(r=>{a.searchParams.delete(r)}),a.toString()}showNavigationFeedback(t,e="info"){let a=this.form.querySelector(".dgwltd-calendar__nav-feedback");a&&a.remove();let r=document.createElement("div");r.className=`dgwltd-calendar__nav-feedback dgwltd-calendar__nav-feedback--${e}`,r.setAttribute("role","status"),r.textContent=t;let f=this.form.querySelector("#calendar-hint");f&&f.appendChild(r),setTimeout(()=>{r.parentNode&&r.remove()},3e3)}formatDate(t){return new Intl.DateTimeFormat("en-GB",{weekday:"long",day:"numeric",month:"long",year:"numeric"}).format(t.toDate())}};function Ot(n){let e=new URLSearchParams(window.location.search).get("highlight");if(e){let a=n.querySelector(`input[value="${e}"]`);if(a){let r=a.closest(".dgwltd-calendar__day");r.classList.add("dgwltd-calendar__day--highlight-next"),a.scrollIntoView({behavior:"smooth",block:"center"}),setTimeout(()=>{r.classList.remove("dgwltd-calendar__day--highlight-next")},5e3)}}}document.addEventListener("DOMContentLoaded",function(){let n=document.querySelector(".dgwltd-calendar__form");if(!n)return;let t=new K(n),e=n.querySelectorAll('input[name="selected_dates[]"]');e.forEach(m=>{let k=t.validateDate(m.value);k.valid?gt(m):ht(m,k.reason)});let a=n.dataset.rangeSelection==="true",r=null;a&&(r=new X(n,t),Tt(n));let f=n.dataset.navigation==="true",u=null;f&&(u=new tt(n,t)),Ot(n),n.addEventListener("change",function(){t.needsRevalidation()&&xt(t,e)}),console.log("\u2705 Enhanced Calendar System initialized:",{validation:t.validationType,rangeSelection:a,navigation:f,totalDates:e.length,validDates:Array.from(e).filter(m=>!m.disabled).length})});})();
